# 概述

Spring Security 基于 Spring 框架，提供了一套 Web 完整的安全解决方案。



一般来说，Web 应用的安全性包括两个方面：用户认证、用户授权。

**用户认证：**验证某个用户是否为合法主体，要求使用者提供证明自身合法的元素，一般来说就是账号密码。

**用户授权：**验证某个用户是否具备某些权限，一个用户不具备的权限，系统正确的做法就是拒绝操作。



Spring Security 特点：

- 专为 Spring 技术栈开发，与 Spring 框架无缝集成
- 全面的权限控制
- 重量级：需要依赖太多



与同款技术比较，Shiro  是 Apache 轻量级的权限框架，依赖少，不局限于 Web 开发环境，缺点就是在 Web 某些场景下需要手动编写代码定制开发。



它们两个总结来说，一个是支持功能丰富，一个是灵活。



# 认证（Authentication）

认证主要策略接口时：AuthenticationManager，它只有一个方法。

```java
public interface AuthenticationManager {

  Authentication authenticate(Authentication authentication)
    throws AuthenticationException;
}
```

这个方法可以有三种结果：

- 如果可以正常验证输入是否合法有效，那么将会返回验证后结果。
- 如果它认为输入代表无效的主体，则抛出 `AuthenticationException`
- 如果无法决定，则返回 null



`AuthenticationManager` 最常用的实例 `ProviderManager`，它将对构成实例链的 `AuthenticationProvider` 认证提供者进行顺序尝试，直到其中提供者放回非空响应，若是一直到结束都没有返回非空响应，那么会尝试调用提供者父类的认证方法。

`AuthenticationProvider ` 接口扩展了一个方法，该方法可以用于查询是否支持给定的 `Authentication`类型。



**梳理下它们的关系：**

- **AuthenticationManager**：这个策略接口是用于认证的，作用就是身份验证管理器，实现了它，就是一个身份验证管理器。
- **ProviderManager**：是 AuthenticationManager 常用的一个实现，对身份认证的管理，调用**认证服务的提供者**，实际逻辑是它们处理的，ProviderManager 是作为一个管理者的角色去执行**认证服务的提供者**。
- **AuthenticationProvider**：这个接口是实际认证功能的提供者，也就是说身份合不合法，如何验证，是由这些提供者说了算的，它们是认证的提供者。通常，认证的提供者有多个，ProviderManager 会遍历 AuthenticationProvider 的所有实现，分别调用扩展的 supprots 的方法，首先就验证提供者是否支持传递 Authentication 类型，若支持则会调用对应的认证方法进行处理。

它们就是管理者和提供者的区分，类似上级领导和劳动员工的工作职责，但是它们没有直接或间接的依赖关系。

```java
public interface AuthenticationProvider {

	Authentication authenticate(Authentication authentication)
			throws AuthenticationException;

	boolean supports(Class<?> authentication);
}
```

`support()` 方法中的 `Class<?>` 参数实际上是 `Class<? extends Authentication>`（只询问它是否支持传递给 `authenticate() ` 方法的东西）。 `ProviderManager` 可以通过委托给 AuthenticationProviders 链在同一应用程序中支持多种不同的身份验证机制。如果 `ProviderManager` 无法识别特定的 `Authentication ` 实例类型，则会跳过它。

`ProviderManager` 有一个可选的父级，如果所有 AuthenticationProvider 提供者都返回 `null`，那么会调用父类的方法进行验证身份，如果父类不可用，则空身份验证会导致 `AuthenticationException`。



有时，应用程序具有受保护资源的逻辑组（例如，匹配路径模式的所有 Web 资源，例如 /api/**），并且每个组都可以有自己专用的 AuthenticationManager。通常，其中的每一个都是一个 ProviderManager，并且它们共享一个父级。父级是一种“全局”资源，充当所有提供者的后备。



# 授权（AccessControl）





# 模块划分





